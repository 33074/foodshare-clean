# Defines the services for Render

# 1. Define the MySQL Database
databases:
  - name: foodshare-mysql # This is the logical name
    databaseName: foodshare_db
    user: foodshare_user
    plan: free 

# 2. Define the Spring Boot Backend Web Service
services:
  - type: web 
    name: foodshare-backend # This is the logical name
    runtime: docker 
    repo: https://github.com/33074/foodshare-clean.git 
    branch: main
    dockerContext: ./foodshare-backend 
    dockerfilePath: ./foodshare-backend/Dockerfile 
    plan: free
    healthCheckPath: /actuator/health
    envVars: 
      # --- THIS IS THE FIX ---
      # DO NOT set SPRING_DATASOURCE_URL.
      # Provide the individual components. Spring Boot will find them.
      - key: SPRING_DATASOURCE_HOST
        fromDatabase:
          name: foodshare-mysql
          property: host
      - key: SPRING_DATASOURCE_PORT
        fromDatabase:
          name: foodshare-mysql
          property: port
      - key: SPRING_DATASOURCE_USERNAME
        fromDatabase:
          name: foodshare-mysql
          property: user
      - key: SPRING_DATASOURCE_PASSWORD
        fromDatabase:
          name: foodshare-mysql
          property: password
      # We must also tell Spring Boot the database name
      # (Note: Spring Boot looks for 'spring.datasource.name', but 'SPRING_DATASOURCE_NAME' should also work)
      - key: SPRING_DATASOURCE_NAME
        value: foodshare_db
      # Add other properties Spring needs
      - key: SPRING_JPA_PROPERTIES_HIBERNATE_DIALECT
        value: org.hibernate.dialect.MySQLDialect
      - key: SPRING_JPA_HIBERNATE_DDL_AUTO
        value: update
      # --- END FIX ---

      # --- ALL OTHER SECRETS ---
      - key: JWT_SECRET_KEY
        sync: false # Set in Render dashboard
      - key: SPRING_MAIL_HOST
        value: smtp-relay.brevo.com
      - key: SPRING_MAIL_PORT
        value: 587
      - key: SPRING_MAIL_USERNAME
        value: 9a20a6001@smtp-brevo.com
      - key: SPRING_MAIL_PASSWORD
        sync: false # Set in Render dashboard
      - key: SPRING_MAIL_FROM
        value: 2300033074cseh2@gmail.com
      - key: GOOGLE_CLIENT_ID
        sync: false # Set in Render dashboard
      - key: GOOGLE_CLIENT_SECRET
        sync: false # Set in Render dashboard
